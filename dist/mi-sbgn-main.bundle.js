!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=185)}({185:function(module,__webpack_exports__,__webpack_require__){"use strict";function initViewer(complexName){complexName&&(currentComplex=complexName),$.get({dataType:"json",url:"https://www.ebi.ac.uk/intact/complex-ws/export/"+currentComplex},function(data){new MIModel(data).load().then(function(model){complexViewer=new __WEBPACK_IMPORTED_MODULE_2__model_ComplexView__.a({model:model,el:document.getElementById(svgElementId),graphView:graphView}),document.getElementById("complextitle").innerHTML=currentComplex})})}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"setAttr",function(){return setAttr}),__webpack_require__.d(__webpack_exports__,"createElem",function(){return createElem}),__webpack_require__.d(__webpack_exports__,"graphView",function(){return graphView}),__webpack_require__.d(__webpack_exports__,"complexViewer",function(){return complexViewer}),__webpack_exports__.default=initViewer;for(var __WEBPACK_IMPORTED_MODULE_0__model_Graph__=__webpack_require__(186),__WEBPACK_IMPORTED_MODULE_2__model_ComplexView__=(__webpack_require__(93),__webpack_require__(187)),__WEBPACK_IMPORTED_MODULE_10__XMLdownloader__=(__webpack_require__(92),__webpack_require__(98),__webpack_require__(96),__webpack_require__(97),__webpack_require__(94),__webpack_require__(48),__webpack_require__(47),__webpack_require__(188)),__WEBPACK_IMPORTED_MODULE_11__router__=__webpack_require__(189),svgElementId=(__webpack_require__(95),"mi-sbgn"),currentComplex="EBI-9997373",setAttr=function(elem,x,y){elem.setAttributeNS(null,x,y)},createElem=function(elemName){return document.createElementNS("http://www.w3.org/2000/svg",elemName)},graphView=new __WEBPACK_IMPORTED_MODULE_0__model_Graph__.a,complexViewer=null,generateXMLButtons=document.querySelectorAll(".download-sbgn"),i=0;i<generateXMLButtons.length;i++){generateXMLButtons.item(i).addEventListener("click",function(event){var complexXML=complexViewer.toXML();Object(__WEBPACK_IMPORTED_MODULE_10__XMLdownloader__.a)(complexXML,"xml",currentComplex)})}try{document.getElementById("complexSelector").addEventListener("change",function(event){event.target.value;route.navigate(event.target.value,{trigger:!0})})}catch(e){console.debug("didn't initialise complex selector as the element wan't provided on the page")}if(window.miSBGNDemo)var route=new __WEBPACK_IMPORTED_MODULE_11__router__.a(initViewer);else window.initViewer=initViewer},186:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a=function(){this.graph={nodes:[],links:[],linkDeduplicationLookup:{},nodeIndexLookup:{},groups:[]},this.addNode=function(node){return this.graph.nodeIndexLookup[node.model.cid]=this.graph.nodes.length,this.graph.nodes.push(node),node},this.addLinkIndex=function(link1,link2){this.graph.linkDeduplicationLookup[link1]?this.graph.linkDeduplicationLookup[link1].push(link2):this.graph.linkDeduplicationLookup[link1]=[link2]},this.addLinkIndexes=function(link1,link2){this.addLinkIndex(link2,link1),this.addLinkIndex(link1,link2)},this.isDuplicate=function(link1,link2){var l1isLinkedTol2,l2isLinkedTol1,l1=this.graph.linkDeduplicationLookup[link1],l2=this.graph.linkDeduplicationLookup[link2];return l1&&(l1isLinkedTol2=-1!==l1.indexOf(link2)),l2&&(l2isLinkedTol1=-1!==l2.indexOf(link1)),l1isLinkedTol2||l2isLinkedTol1},this.addLink=function(source,target){var sourceindex=this.graph.nodeIndexLookup[source],targetindex=this.graph.nodeIndexLookup[target];if(!this.isDuplicate(sourceindex,targetindex)){var link=new __WEBPACK_IMPORTED_MODULE_0__Link__.a(source,target,{source:sourceindex,target:targetindex});this.addLinkIndexes(sourceindex,targetindex),this.graph.links.push(link)}},this.updateNodeSizes=function(){this.graph.nodes.map(function(node){var bb=node.node.getBBox();node.width=bb.width,node.height=bb.height})},this.addGroup=function(group,parentCid){var g={leaves:[],padding:3,margin:6};return parent=this,group.map(function(groupMember){var identifier=groupMember.cid;g.leaves.push(parent.graph.nodeIndexLookup[identifier])}),this.graph.groups.push(g),g},this.addLinks=function(){this.graph.nodes.map(function(aNode){aNode.addLinks()})},this.boundsToSBGNCoords=function(someNodeBounds){return{y:someNodeBounds.y.toFixed(0),x:someNodeBounds.x.toFixed(0),w:(someNodeBounds.X-someNodeBounds.x).toFixed(0),h:(someNodeBounds.Y-someNodeBounds.y).toFixed(0)}}};var __WEBPACK_IMPORTED_MODULE_0__Link__=__webpack_require__(92)},187:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__Participant__=__webpack_require__(96),__WEBPACK_IMPORTED_MODULE_1__Layout__=__webpack_require__(98),ComplexView=Backbone.View.extend({className:"sbgnContainer",initialize:function(x){this.interactors=this.model.attributes.interactors.models,this.participants=[],this.graphView=x.graphView,this.render(),this.listenTo(this.model,"change",this.render)},empty:function(){this.$el.html(""),this.node=null},render:function(){try{this.instantiateParticipants(),this.graphView.addLinks(),this.layout=new __WEBPACK_IMPORTED_MODULE_1__Layout__.a(this.el,this.graphView)}catch(e){console.error("%cerror--\n This is probably a known error with trying to re-initialise mi-model on the same page after it's been initialised once already.\n","background-color:firebrick; color:#eee;font-weight:bold;",e)}return this},instantiateParticipants:function(){var parent=this;this.model.get("interactions").at(0).get("participants").map(function(participant){var newParticipant=new __WEBPACK_IMPORTED_MODULE_0__Participant__.a(participant,parent.graphView);parent.participants.push(newParticipant)}),this.participants.map(function(participant){participant.addGroup()})},generateParticipantXML:function(){var participantXML=[];return this.participants.map(function(participant){participantXML.push(participant.toXML())}),participantXML},generateLinkXML:function(){var linkXML=[];return this.graphView.graph.links.map(function(link){linkXML.push(link.toXML())}),linkXML},toXML:function(){var participantXML=this.generateParticipantXML(),linkXML=this.generateLinkXML();return jstoxml.toXML({_name:"sbgn",_content:{_attrs:{language:"entity relationship"},_content:participantXML.concat(linkXML),_name:"map"},_attrs:{xmlns:"http://sbgn.org/libsbgn/0.2"}},{header:!0})}});__webpack_exports__.a=ComplexView},188:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a=function(fileContents,fileFormat,fileName){let encodingType="data:text/"+fileFormat+";charset=utf-8,";var encodedUri=encodeURI(encodingType+fileContents),link=document.createElement("a");link.setAttribute("href",encodedUri),link.setAttribute("download",fileName+".xml"),document.body.appendChild(link),link.click()}},189:function(module,__webpack_exports__,__webpack_require__){"use strict";function router(initViewer){var AppRouter=Backbone.Router.extend({routes:{"*actions":"defaultRoute"}});return this.appRouter=new AppRouter,this.appRouter.on("route:defaultRoute",function(complex){complex?(console.log("navigating",complex),initViewer(complex)):initViewer()}),Backbone.history.start(),this}__webpack_exports__.a=router,router.prototype.navigate=function(whereTo){this.appRouter.navigate(whereTo,{trigger:!0}),window.location.reload()}},47:function(module,__webpack_exports__,__webpack_require__){"use strict";function UnitOfInformation(info){this.info={protein:"mt:prot",binding:"ct:bind"}[info]}__webpack_exports__.a=UnitOfInformation,UnitOfInformation.prototype.toXML=function(){return jstoxml.toXML({_name:"glyph",_attrs:{id:this.rect.id,class:"unit of information"},_content:[{_name:"label",_attrs:{text:this.info}},{_name:"bbox",_attrs:{y:this.rect.y.baseVal.value-this.rect.height.baseVal.value,x:this.rect.x.baseVal.value,w:this.rect.width.baseVal.value,h:this.rect.height.baseVal.value}}]})}},48:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a=function(){var intersection=function(lines){return Object(__WEBPACK_IMPORTED_MODULE_0__external_line_segments_intersect_js__.a)(lines.box.start,lines.box.end,lines.link.start,lines.link.end)};return{boxLineIntersection:function(rectangle,line,previousLine,prevlinecoord){var box=rectangle.node.getBBox();box.center={x:rectangle.getCenterX(),y:rectangle.getCenterY()};var corners={topleft:{x:box.x,y:box.y},topright:{x:box.x+box.width,y:box.y},bottomleft:{x:box.x,y:box.y+box.height},bottomright:{x:box.x+box.width,y:box.y+box.height}},lines={top:{start:corners.topleft,end:corners.topright},right:{start:corners.topright,end:corners.bottomright},bottom:{start:corners.bottomleft,end:corners.bottomright},left:{start:corners.topleft,end:corners.bottomleft}},overlapper=null,newEndpoint={x:null,y:null};for(var lineorientation in lines)intersection({box:lines[lineorientation],link:{start:line.source,end:line.target}})&&(overlapper=lineorientation);switch(overlapper){case"top":newEndpoint={x:box.center.x,y:box.y-4};break;case"bottom":newEndpoint={x:box.center.x,y:box.y+box.height+4};break;case"left":newEndpoint={x:box.x,y:box.center.y};break;case"right":newEndpoint={x:box.x+box.width,y:box.center.y};break;case"previous":newEndpoint={x:previousLine.getAttribute("x"+prevlinecoord),y:previousLine.getAttribute("y"+prevlinecoord)},console.log("%cnewEndpoint","color:turquoise;font-weight:bold;",newEndpoint);break;default:newEndpoint={x:box.center.x,y:box.center.y}}return newEndpoint}}};var __WEBPACK_IMPORTED_MODULE_0__external_line_segments_intersect_js__=__webpack_require__(95)},92:function(module,__webpack_exports__,__webpack_require__){"use strict";function Link(source,target,indexes){return this.source=indexes.source,this.target=indexes.target,this.sourceObject=source,this.targetObject=target,this.id=source+"-"+target,this.coords={},this}__webpack_exports__.a=Link,Link.prototype.toXML=function(){return jstoxml.toXML({_name:"arc",_attrs:{id:this.id,class:"interaction",source:this.sourceObject,target:this.targetObject},_content:[{_name:"start",_attrs:{y:this.coords.y1,x:this.coords.x1}},{_name:"end",_attrs:{y:this.coords.y2,x:this.coords.x2}}]})},Link.prototype.equals=function(link){return this.link.target===link.link.target&&this.link.source===link.link.source||this.link.target===link.link.source&&this.link.source===link.link.target}},93:function(module,__webpack_exports__,__webpack_require__){"use strict";function BindingSite(model,graphView){return this.model=model,this.name="binding region",this.cid=this.model.cid,this.graphView=graphView,this.graphView.addNode(this),this.uoi=new __WEBPACK_IMPORTED_MODULE_0__UnitOfInformation__.a("binding"),this.position=new __WEBPACK_IMPORTED_MODULE_1__StateVariable__.a(model.get("pos")),this}__webpack_exports__.a=BindingSite;var __WEBPACK_IMPORTED_MODULE_0__UnitOfInformation__=__webpack_require__(47),__WEBPACK_IMPORTED_MODULE_1__StateVariable__=__webpack_require__(94),__WEBPACK_IMPORTED_MODULE_2__Maths__=__webpack_require__(48);BindingSite.prototype.getCenterX=function(){var bb=this.node.getBBox();return bb.x+bb.width/2},BindingSite.prototype.getCenterY=function(){var bb=this.node.getBBox();return bb.y+bb.height/2},BindingSite.prototype.getArrowTarget=function(line,previousLine,prevlinecoord){return Object(__WEBPACK_IMPORTED_MODULE_2__Maths__.a)().boxLineIntersection(this,line,previousLine,prevlinecoord)},BindingSite.prototype.addLinks=function(){var parent=this;this.model.get("feature").get("linkedFeatures").models.map(function(linkedFeature){var bindingRegions=linkedFeature.get("sequenceData");bindingRegions?bindingRegions.map(function(region){parent.graphView.addLink(parent.model.cid,region.cid)}):console.error("%c something went wrong with the link for","color:orange;",this)})},BindingSite.prototype.toXML=function(){return jstoxml.toXML({_name:"glyph",_attrs:{id:this.model.cid,class:"entity"},_content:[{_name:"label",_attrs:{text:"binding region"}},{_name:"bbox",_attrs:this.graphView.boundsToSBGNCoords(this.bounds)},this.uoi.toXML(),this.position.toXML(this.bounds.y)]})}},94:function(module,__webpack_exports__,__webpack_require__){"use strict";function StateVariable(info){this.info=info}__webpack_exports__.a=StateVariable,StateVariable.prototype.toXML=function(parentTop){return jstoxml.toXML({_name:"glyph",_attrs:{id:this.rect.id,class:"state variable"},_content:[{_name:"state",_attrs:{value:this.info}},{_name:"bbox",_attrs:{y:parentTop,x:this.rect.x.baseVal.value.toFixed(0),w:this.rect.width.baseVal.value.toFixed(0),h:this.rect.height.baseVal.value.toFixed(0)}}]})}},95:function(module,__webpack_exports__,__webpack_require__){"use strict";function crossProduct(point1,point2){return point1.x*point2.y-point1.y*point2.x}function subtractPoints(point1,point2){var result={};return result.x=point1.x-point2.x,result.y=point1.y-point2.y,result}function equalPoints(point1,point2){return point1.x==point2.x&&point1.y==point2.y}function allEqual(args){var i,firstValue=arguments[0];for(i=1;i<arguments.length;i+=1)if(arguments[i]!=firstValue)return!1;return!0}__webpack_exports__.a=function(p,p2,q,q2){var r=subtractPoints(p2,p),s=subtractPoints(q2,q),uNumerator=crossProduct(subtractPoints(q,p),r),denominator=crossProduct(r,s);if(0==uNumerator&&0==denominator)return!!(equalPoints(p,q)||equalPoints(p,q2)||equalPoints(p2,q)||equalPoints(p2,q2))||!allEqual(q.x-p.x<0,q.x-p2.x<0,q2.x-p.x<0,q2.x-p2.x<0)||!allEqual(q.y-p.y<0,q.y-p2.y<0,q2.y-p.y<0,q2.y-p2.y<0);if(0==denominator)return!1;var u=uNumerator/denominator,t=crossProduct(subtractPoints(q,p),s)/denominator;return t>=0&&t<=1&&u>=0&&u<=1}},96:function(module,__webpack_exports__,__webpack_require__){"use strict";function Participant(model,graphView){return this.graphView=graphView,this.init(model),this}__webpack_exports__.a=Participant;var __WEBPACK_IMPORTED_MODULE_0__ParticipantLabel__=__webpack_require__(97),__WEBPACK_IMPORTED_MODULE_1__UnitOfInformation__=__webpack_require__(47),__WEBPACK_IMPORTED_MODULE_2__BindingSite__=__webpack_require__(93);Participant.prototype.addGroup=function(){var groupMembers=this.bindingSites.concat(this.label);this.group=this.graphView.addGroup(groupMembers,this.model.cid)},Participant.prototype.getBounds=function(){return this.graphView.boundsToSBGNCoords(this.group.bounds)},Participant.prototype.generateBindingSiteXML=function(){var sites=[];return this.node.bindingSites.map(function(bindingSite){sites.push(bindingSite.toXML())}),sites},Participant.prototype.toXML=function(){var bindingSiteXML=this.generateBindingSiteXML(),participantXML=[{_name:"label",_attrs:{text:this.label.name}},{_name:"bbox",_attrs:this.getBounds()}];return jstoxml.toXML({_name:"glyph",_attrs:{id:this.model.cid,class:"entity"},_content:participantXML.concat(bindingSiteXML)})},Participant.prototype.init=function(model){if(this.model=model,this.node={},this.interactor=this.model.get("interactor"),this.initFeatures(),this.initBindingSites(),this.label=new __WEBPACK_IMPORTED_MODULE_0__ParticipantLabel__.a(this.interactor.get("label"),this.interactor.cid),this.graphView.addNode(this.label,this.interactor.cid),this.node.uoi=new __WEBPACK_IMPORTED_MODULE_1__UnitOfInformation__.a(this.interactor.get("type").name),this.bindingSites){var parent=this;parent.node.bindingSites=[],this.bindingSites.map(function(site){var newSite=new __WEBPACK_IMPORTED_MODULE_2__BindingSite__.a(site,parent.graphView);parent.node.bindingSites.push(newSite)})}},Participant.prototype.initFeatures=function(){if(this.features=this.model.get("features"),this.features.length>0?this.features=this.features.models:this.features=!1,this.features){this.links=[];var links=[];this.features.map(function(feature){parseInt(feature.get("linkedFeatures").models[0].get("id"),10),parseInt(feature.get("id"),10);links=links.concat(feature.get("linkedFeatures").models)})}},Participant.prototype.initBindingSites=function(){var binding=[];this.features&&(this.features.map(function(feature){var seq=feature.get("sequenceData").models;seq?binding=binding.concat(seq):console.log("%cfeature","color:turquoise;font-weight:bold;",feature)}),binding.length>0&&(this.bindingSites=binding))}},97:function(module,__webpack_exports__,__webpack_require__){"use strict";function Label(textContent,parentId){return labelcount++,this.model={cid:parentId+"-label-"+labelcount},this.cid=this.model.cid,this.name=textContent,this}__webpack_exports__.a=Label;var labelcount=0;Label.prototype.addLinks=function(){},Label.prototype.setLocation=function(x,y){}},98:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a=function(el,graphView){var svg=this.svg=d3.select(el);this.svgsize=el.getBoundingClientRect();var styles_padding=3;try{var width=this.svgsize.height,height=this.svgsize.height,pad=styles_padding;el.setAttribute("width",width+"px"),el.setAttribute("height",height+"px"),svg.append("defs").append("marker").attr("id","Harpoon").attr("viewbox","0 0 20 20").attr("refX",20).attr("refY",20).attr("markerWidth",40).attr("markerHeight",40).attr("orient","auto").append("path").attr("d","M 0,0 40,20 0,40 20,20 Z"),svg.append("defs").append("marker").attr("id","Upside-down-harpoon").attr("viewbox","0 0 20 20").attr("refX",20).attr("refY",20).attr("markerWidth",40).attr("markerHeight",40).attr("orient","auto").append("path").attr("d","M 0,20 40,40 20,20 40,0 Z"),graphView.graph.nodes.forEach(function(node){node.height=41,node.width=41});var c=cola.d3adaptor(d3).linkDistance(200).avoidOverlaps(!0).handleDisconnected(!0).size([width,height]);c.nodes(graphView.graph.nodes).links(graphView.graph.links).groups(graphView.graph.groups),c.start();var group=svg.selectAll(".group interactor").data(graphView.graph.groups).enter().append("rect").attr("rx",5).attr("ry",5).attr("class","interactor").call(c.drag),node=svg.selectAll(".node").data(graphView.graph.nodes).enter().append("g").attr("class",function(d){return d.node=this,"node "+d.constructor.name+" "+d.cid}).call(c.drag).on("mouseup",function(d){d.fixed=0,c.alpha(1)}),binding=svg.selectAll(".BindingSite"),bindingborder=binding.append("rect").attr("class","bindingborder"),labeltext=node.append("text").text(function(d){return d.name}).call(c.drag),link=svg.selectAll(".link").data(graphView.graph.links).enter().append("line").attr("class","link").attr("marker-start","url(#Upside-down-harpoon)").attr("marker-end","url(#Harpoon)").call(c.drag),uoig=binding.append("g").attr("class","uoigroup"),uoirect=uoig.append("rect");uoirect.attr("id",function(d){return d.uoi.rect=this,d.cid+"-uoi"});var uoitext=uoig.append("text").attr("class","uoitext").text(function(d){return d.uoi.info}).call(c.drag),locg=binding.append("g").attr("class","locationgroup"),locrect=locg.append("rect");locrect.attr("id",function(d){return d.position.rect=this,d.cid+"-position"});var locationOfBinding=locg.append("text").attr("class","position").text(function(d){return" "+d.position.info}).call(c.drag),initialisedSizes=!1;c.on("tick",function(x,y,z){link.attr("x1",function(d){return d.coords.x1=d.source.getArrowTarget(d,this,"1").x,d.coords.x1}).attr("y1",function(d){return d.coords.y1=d.source.getArrowTarget(d,this,"1").y,d.coords.y1}).attr("x2",function(d){return d.coords.x2=d.target.getArrowTarget(d,this,"2").x,d.coords.x2}).attr("y2",function(d){return d.coords.y2=d.target.getArrowTarget(d,this,"2").y,d.coords.y2}),labeltext.attr("x",function(d){return d.x-d.width/2+2*pad}).attr("y",function(d){var h=this.getBBox().height;return d.y+2*h}).attr("width",function(d){var w=this.getBBox().width;return"Label"==d.constructor.name&&(d.width=w),w+2*pad}),node.attr("height",function(d){return d.height=this.getBBox().height,this.getBBox().height}),bindingborder.attr("x",function(d){return d.x-this.getBBox().width/2}).attr("y",function(d){return d.y+this.nextSibling.getBBox().height/2}).attr("height",function(d){var childnodes=this.parentNode.querySelectorAll("g");return childnodes[0].getBBox().y-childnodes[1].getBBox().y}).attr("width",function(d){return d.width=this.nextSibling.getBBox().width+4*pad,this.nextSibling.getBBox().width+2*pad}),uoig.attr("x",function(d){return d.x-this.getBBox().width/2+2*pad}).attr("y",function(d){var h=this.getBBox().height;return d.y+h}).attr("height","20").attr("width",function(d){return this.getBBox().width}),uoitext.attr("x",function(d){return d.x-this.getBBox().width/2}).attr("y",function(d){var h=this.getBBox().height;return d.y+3*h}).attr("height","20").attr("width",function(d){return this.getBBox().width}),uoirect.attr("x",function(d){return d.x-this.getBBox().width/2}).attr("y",function(d){var h=this.getBBox().height;return d.y+2*h}).attr("height","20").attr("width",function(d){return this.parentNode.getBBox().width}),locationOfBinding.attr("x",function(d){return d.x-this.getBBox().width/2}).attr("y",function(d){var h=this.getBBox().height;return d.y+h}),locrect.attr("x",function(d,f,g){return d.x-this.getBBox().width/2+pad}).attr("rx","10").attr("ry","10").attr("y",function(d){return d.y}).attr("height",function(d){return this.parentNode.getBBox().height}).attr("width",function(d){return this.parentNode.getBBox().width}),group.attr("x",function(d){return d.bounds.x+pad}).attr("y",function(d){return d.bounds.y+30}).attr("width",function(d){return d.bounds.width()-pad}).attr("height",function(d){return d.bounds.height()}),initialisedSizes=!0})}catch(e){console.log("%ce","color:cornflowerblue;font-family:sans-serif;",e)}return this};__webpack_require__(48)}});